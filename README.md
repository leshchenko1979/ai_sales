# Sales Bot

Telegram-бот для автоматизации холодных продаж инвестиционных проектов. Бот ведет диалоги с потенциальными инвесторами, квалифицирует их и назначает звонки с менеджером.

## Основной функционал

### Управление аккаунтами
- Добавление и авторизация пользовательских аккаунтов
- Автоматическая ротация аккаунтов
- Мониторинг состояния и блокировок
- Система прогрева аккаунтов
- Контроль лимитов сообщений
- Защита от блокировок

### Управление диалогами
- Запуск диалога с конкретным пользователем
- Просмотр активных диалогов
- Остановка диалога
- Просмотр истории диалога
- Выгрузка диалогов в файл

### Автоматизация общения
- Автоматические ответы с использованием GPT
- Базовая квалификация лидов (проверка чека и сроков)
- Передача диалога живому менеджеру при необходимости

### Мониторинг и уведомления
- Мониторинг состояния аккаунтов
- Уведомления о блокировках
- Уведомления о достижении лимитов
- Ежедневные отчеты о состоянии системы

## Технический стек

### Backend
- Python (монолитное приложение)
- PostgreSQL (хранение данных)
- OpenAI API (генерация ответов)
- Telegram API:
  - MTProto API (для пользовательских аккаунтов)
  - Bot API (для админки)
- Pyrogram (клиентская библиотека)

### Инфраструктура
- VPS сервер (Ubuntu 22.04)
- Systemd для управления процессом
- Long polling режим работы

## Административные команды

### Управление аккаунтами
```
/add_account phone - добавить новый аккаунт
/authorize phone code - авторизовать аккаунт
/list_accounts - список всех аккаунтов
/disable_account phone - отключить аккаунт
/check_account phone - проверить состояние аккаунта
/check_all - проверить все аккаунты
```

### Управление диалогами
```
/start @username - начать диалог
/stop N - остановить диалог номер N
/list - список активных диалогов
/view N - просмотр диалога номер N
/export N - выгрузка диалога номер N в файл
/export_all - выгрузка всех диалогов
```

## Структура проекта
```
sales_bot/
├── config.py           # Конфигурация приложения
├── main.py            # Точка входа
├── accounts/          # Управление аккаунтами
│   ├── client.py      # MTProto клиент
│   ├── manager.py     # Менеджер аккаунтов
│   ├── models.py      # Модели аккаунтов
│   ├── monitoring.py  # Мониторинг состояния
│   ├── notifications.py # Система уведомлений
│   ├── rotation.py    # Ротация аккаунтов
│   ├── safety.py      # Защита от блокировок
│   └── warmup.py      # Прогрев аккаунтов
├── bot/               # Логика бота
│   ├── client.py      # Клиент админ-бота
│   ├── commands.py    # Обработчики команд
│   ├── dialogs.py     # Управление диалогами
│   └── gpt.py         # Интеграция с GPT
├── db/                # Работа с базой данных
│   ├── models.py      # Модели данных
│   ├── queries.py     # SQL запросы
│   └── migrate.py     # Миграции БД
└── utils/             # Вспомогательные функции
    ├── export.py      # Экспорт диалогов
    └── logging.py     # Настройка логирования
```

## Установка и запуск

1. Клонирование репозитория
```bash
git clone [repository_url]
cd sales_bot
```

2. Настройка окружения
```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

3. Настройка конфигурации
```bash
cp config.example.py config.py
# Отредактируйте config.py, добавив необходимые токены
```

4. Настройка базы данных
```bash
psql -U postgres -f init_db.sql
python -m sales_bot.db.migrate
```

5. Запуск бота
```bash
python main.py
```

## Безопасность аккаунтов

- Лимиты на количество сообщений в день
- Минимальные задержки между сообщениями
- Автоматическое отключение при подозрении на блокировку
- Ротация аккаунтов для равномерной нагрузки
- Система прогрева новых аккаунтов
- Мониторинг состояния и оповещения

## Документация
- [Архитектура](docs/architecture_mvp.md)
- [План реализации](docs/implementation_plan.md)
- [Детали MVP](docs/mvp_details.md)
